<dom-module id="grid-pagination-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <style>
      vaadin-grid {
        text-transform: none;
      }
    </style>


    <h3 style="text-align:center">Drug Visualization</h3>
    <p>
	
    </p>
	
      <div id="plot"></div>

    <vaadin-demo-snippet id='grid-pagination-demos-pagination'>
      <template preserve-content>
        <x-pagination></x-pagination>
        <dom-module id="x-pagination">
          <template preserve-content>
            <style>
              #pages {
                display: flex;
                flex-wrap: wrap;
                margin: 20px;
              }

              #pages > button {
                user-select: none;
                padding: 5px;
                margin: 0 5px;
                border-radius: 10%;
                border: 0;
                background: transparent;
                font: inherit;
                outline: none;
                cursor: pointer;
              }

              #pages > button:hover,
              #pages > button:focus {
                color: #ccc;
                background-color: #eee;
              }

              #pages > button[selected] {
                font-weight: bold;
                color: white;
                background-color: #ccc;
              }
            </style>
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!-----------------------------------1----------------------------->
<iron-ajax auto url="http://drugcomb.fimm.fi/combinations"
 headers='{Access-Control-Allow-Headers: *}'
 handle-as="json"
	  last-response="{{items}}" >
</iron-ajax>



<!-----------------------------------2----------------------------->

<!--
 <iron-ajax
            id="ajax"
            auto
            url="{{_makeUrl(routeDataGig.gigId)}}"
            handle-as="json"
            debounce-duration="300"
            last-response="{{response}}"
          ></iron-ajax>
		  
		  
<iron-ajax auto 
    url="{{resolveUrl}}"
    headers='{Access-Control-Allow-Headers: *}'
    

	  handle-as="json"
	  on-response="handleResponse1">
</iron-ajax>

-->

<!--
<iron-ajax auto 
    url="http://drugcomb.fimm.fi/dose"
    headers='{Access-Control-Allow-Headers: *}'
    params='{"id":2}'

	  handle-as="json"
	  on-response="handleResponse7">
</iron-ajax>
-->
<!-----------------------------------3----------------------------->
<iron-ajax auto url="test2.json"
	  handle-as="json"
	  on-response="handleResponse2">
</iron-ajax>
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->
<!---------------------------------------------------------------->

<!--<button id="demo" onclick="myFunction()" class="button button4">Show me the Graph</button>-->



    <paper-button id="msbutton" on-click="_changeText">
	Show Graph
	<template is="dom-repeat" id="test" items="[[selectedItems]]">
        <div id="hideme" style="display: none;">{{item.CellLine}} e</div>
    </template>

	
	
	</paper-button>

	<!--
<div id="DIV1">
{{selectedItems}}
</div>
<div id="DIV1">
[[_selectedItemsChanged(selectedItems)]]

[[_selectedItemChanged(selectedItem)]]

</div>

<template is="dom-repeat" id="test" items="[[selectedItems]]">
        <div>{{item.CellLine}}</div>
    </template>
	
	
-->	
	
            <vaadin-grid id="grid" page-size="10" height-by-rows  items="[[items]]" inverted$="[[inverted]]" 
			selected-items={{selectedItems}} active-item="{{selectedItem}}">

			  <vaadin-grid-selection-column auto-select>
              </vaadin-grid-selection-column>

              <vaadin-grid-column>
                <template class="header">DrugA</template>
                <template>
                  [[item.DrugA]]
                </template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">DrugB</template>
                <template>
                  [[item.DrugB]]
                </template>
              </vaadin-grid-column>

              <vaadin-grid-column width="200px">
                <template class="header">CellLine</template>
                <template>
                  <div>[[item.CellLine]]</div>
                </template>
              </vaadin-grid-column>
			  
			   <vaadin-grid-column width="200px">
                <template class="header">Source</template>
                <template>
                  <div>[[item.Source]]</div>
                </template>
              </vaadin-grid-column>
			  
			  
            </vaadin-grid>
            <div id="pages">
              <button on-click="_prev">&lt;</button>
              <template is="dom-repeat" items="[[pages]]">
                <button  style="display:none;" on-click="_select" selected$="[[_isSelected(page, item)]]">[[item]]</button>
              </template>
              <button on-click="_next">&gt;</button>
            </div>
			
			
			
		<div class="column"  id="myDiv" style="background-color:; width:100%; height:80%;">
</div>

<div class="outerDiv">
			<div id="we" style="
				color: #000;
				height: 400px;
				width: 50%;
				float: left;" class="leftDiv">
			</div>
			<div id="third" style="
				color: #000;
				height: 400px;
				width: 50%;
				float: right;" class="rightDiv">
			</div>		
			<div "style: clear:both;"></div>
		</div>





          </template>
		  
		  
		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

		  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		      <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script type="text/javascript" src="loader.js"></script>



          <script>
		  
		

		    var results1=[];
  var results2=[];
var doses=[];
		  var sel=[];
            window.addDemoReadyListener('#grid-pagination-demos-pagination', function(document) {
			  'use strict';
              Polymer({
                is: 'x-pagination',
                _changeText: function() {
				
				myFunction(this.$.myDiv,this.$.we,this.$.third);
   
	}
,
                properties: {
				inverted: {
          type: Boolean,
          value: false
        }, selectedItem: {
                    type: Array,
                }
                ,
                selectedItems: {
                    type: Array,
                },
                  items: Array,
                  page: Number,
                  pages: Array
                },
			
        handleResponse1: function(e) {
		results1=e.detail.response;
	  console.log("Data fetching **************");
      console.log(results1);

        },
		
		 handleResponse2: function(e) {
		results2=e.detail.response;
		console.log("seconde data 3D Heatmap Data");
        console.log(results1[0]);

        },
                ready: function() {
                  this.page = 0;
				   

                },

                observers: ['_itemsChanged(items, page)','_selectedItemsChanged(selectedItems.splices)'
				],
  _selectedItemsChanged() {
                console.log(this.selectedItems);
				sel=this.selectedItems;
				
            }
			
			,
                _isSelected: function(page, item) {
				//console.log(item);
                  return page === item - 1;
                },

                _select: function(e) {
                  this.page = e.model.item - 1;
                },

                _next: function() {
                  this.page = Math.min(this.pages.length - 1, this.page + 1);
                },

                _prev: function() {
                  this.page = Math.max(0, this.page - 1);
                },

                _itemsChanged: function(items, page) {
                  if (items === undefined || page === undefined) {
                    return;
                  }

                  if (!this.pages) {
                     this.pages = Array.apply(null, {length: Math.ceil(items.length / this.$.grid.pageSize)}).map(function(item, index) {
                      return index + 1;
                    });
                  }

                  var start = page * this.$.grid.pageSize;
                  var end = (page + 1) * this.$.grid.pageSize;
                  this.$.grid.items = items.slice(start, end);
                }
				
              });
			  
			  
            });
			
	function getJSONP(url, success) {

    var ud = '_' + +new Date,
        script = document.createElement('script'),
        head = document.getElementsByTagName('head')[0] 
               || document.documentElement;

    window[ud] = function(data) {
        head.removeChild(script);
        success && success(data);
    };

    script.src = url.replace('callback=?', 'callback=' + ud);
    head.appendChild(script);

}



   function fetch(url,y,z){
   jQuery.ajax({ 
        type: 'GET',
		
       // url: 'http://drugcomb.fimm.fi/dose/2' ,
		
		url: url,
        dataType: 'json', 
        success: function(data) { 
		doses=data;
	//console.log("doses");
		   console.log("*******************************");
	   console.log("*******************************");
	   console.log("*******************************");

console.log(data);
      //  alert(data.DrugA);
		draw(data,y,z);
		

		
        }
    });

}

function draw(data,y,z){



//alert(data[0].DoseA);

//alert(data[0].DoseB);
//alert(data[0].Response);


console.log(data['DoseA']);

var x_data=[];
var y_data=[];
var z_data=[];

for(i=0;i<data.length;i++)
{
  x_data.push(data[i].DoseA);
 y_data.push(data[i].DoseB);
  z_data.push(data[i].Response);
}

console.log("***********************************X_DATA************************");
console.log(x_data);
console.log("***********************************Y_DATA************************");
console.log(y_data);
console.log("***********************************Z_DATA************************");
console.log(z_data);


var data = [{
    type: "mesh3d",
    x: x_data,
    y: y_data,
    z: z_data,
  
    //intensity: [0, 0.33, 0.66, 1],
    colorscale: [
      [0, 'rgb(255, 0, 0)'],
      [0.5, 'rgb(0, 255, 0)'],
      [1, 'rgb(0, 0, 255)']
    ]
  }
];

Plotly.plot(y, data, {});




var data = [
  {
    z: z_data,
    x: x_data,
    y: y_data,
    type: 'heatmap',
	  colorscale: [
      [0, 'rgb(255, 0, 0)'],
      [0.5, 'rgb(0, 255, 0)'],
      [1, 'rgb(0, 0, 255)']
    ]
  }
];

Plotly.newPlot(z, data);


/*
var data=[
    {
      opacity:0.8,
      color:'rgb(300,100,200)',
      type: 'mesh3d',
      x: x_data,
      y: y_data,
      z: z_data,
    }
];
Plotly.newPlot(y, data);


*/



/*
var data_z1 = {x: x_data, type: 'surface'};
var data_z2 = {y: y_data,  type: 'surface'};
var data_z3 = {z: z_data,  type: 'surface'};



Plotly.newPlot(y, [data_z1, data_z2, data_z3]);

*/


/*
Plotly.d3.csv('https://raw.githubusercontent.com/plotly/datasets/master/api_docs/mt_bruno_elevation.csv', function(err, rows){
function unpack(rows, key) {
  return rows.map(function(row) { return row[key]; });
}
  
var z_data=[ ]
for(i=0;i<24;i++)
{
  z_data.push(unpack(rows,i));
}

var data = [{
           z: z_data,
           type: 'surface'
        }];
  
var layout = {
  title: '3D Drug Visualization',
  autosize: false,
  width: 500,
  height: 500,
  margin: {
    l: 65,
    r: 50,
    b: 65,
    t: 90,
  }
};

Plotly.newPlot(y, data, layout);
});  
*/



}

	
function myFunction(x,y,z) {

var css = [];
var zip = [];
console.log("*******Scatter Plot Data************");
console.log("selected Items IDs");
for(i=0;i<sel.length;i++)
{
console.log(sel[i].DSS);
console.log(sel[i].Synergy_HSA);
css.push(sel[i].DSS);
zip.push(sel[i].Synergy_HSA);
}

console.log("***********************************");


/*
 $(document).ready(function() {

   jQuery.ajax({ 
        type: 'GET',
        url: 'http://drugcomb.fimm.fi/dose/2' ,
        dataType: 'json', 
        success: function(data) { 
		doses=data;
	//	console.log("doses");
//console.log(doses);
         //   alert(data.id);
        }
    });})

*/


	
//console.log("doses");
//console.log(doses);

//console.log("selected items");
//console.log(sel);
  google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

	  


      function drawChart() {
	  
	  	console.log("doses");
        console.log(doses);

	    console.log("selected Items");
	  console.log(sel);


	  
	  
	  
	  
	  
	  
  var er = new google.visualization.DataTable();
  er.addColumn('number', 'css');
  er.addColumn('number', 'zip');

  for(i = 0; i < sel.length; i++)
    er.addRow([css[i], zip[i]]);


  
	  /*
        var er = google.visualization.arrayToDataTable([
          ['ZIP', 'ZIP,CSS'],
          [ 8,      12],
          [ 4,      5.5],
          [ 11,     14],
          [ 4,      5],
          [ 3,      3.5],
          [ 6.5,    7]
        ]);
*/
        var options = {
          title: 'DSS vs. Synergy_HSA Drug comparison',
		  /*
		  hAxis: {title: 'ZIP', minValue: 0, maxValue: 15},
          vAxis: {title: 'CSS', minValue: 0, maxValue: 15},
		  */
		  
		  //Max Min automatically
          hAxis: {title: 'DSS'},
          vAxis: {title: 'Synergy_HSA'},
          legend: 'none'
        };

        var chart = new google.visualization.ScatterChart(x);
  function selectHandler() {
    var selectedItem = chart.getSelection()[0];
    if (selectedItem) {
    //  var value = data.getValue(selectedItem.row, selectedItem.column);
      //alert('The user selected ' + value);
	  console.log("graph selected item");
	  
	  console.log(selectedItem.row);
	  
	  console.log("*******************************");
	  console.log(er.getValue(selectedItem.row, selectedItem.column));
	  
	  
	  
	  
	  
	  
	  







//IDs start from 1 not zero 
var urllink='http://drugcomb.fimm.fi/doses/'+(selectedItem.row+1);
 console.log("********DOSES**************");
	//  console.log(url);
	//   console.log("*******************************");


	/*
getJSONP(urllink, function(data){
console.log("dose data test");
    console.log(JSON.decode(data));
});

*/

fetch(urllink,y,z);


 
    }
  }

  // Listen for the 'select' event, and call my function selectHandler() when
  // the user selects something on the chart.
  google.visualization.events.addListener(chart, 'select', selectHandler);

        chart.draw(er, options);
}

}






/*

var para = document.createElement("p");
var node = document.createTextNode("This is new.");
para.appendChild(node);
y.appendChild(para);

			   console.log("sdsdsdsdssssssssssssssssssssssssssssssssssssssssssssssssssssssss");
			   console.log(sel);
	var trace1 = {
//////////////data for scatter plot/////////////////////////
  x: [1,1, 2, 3, 4, 5],
  y: [1,6,6, 3, 6, 1],
 
 
  mode: 'markers',
  type: 'scatter',
  name: 'Team A',
  //text: ['A-1', 'A-2', 'A-3', 'A-4', 'A-5'],
  marker: { size: 12 }
};

var data = [trace1];
var layout = { 
hovermode:'closest',

  xaxis: {
	   title: 'ZIP',
	  // if you no specifi range mentioned, it means automatic range according to data
      // range: [ 0.75, 5.25 ] 
  },
  yaxis: {
	   title: 'CSS',
    //range: [0, 8]
  },
  title:'Selected Drugs'
};
console.log("Which one is selected :)");
Plotly.newPlot(x,data, layout);

var myPlot = x;
myPlot.on('plotly_click', function(data){
  var pn='',
      tn='',
      colors=[];
	  console.log(data.points);
	  
	
//////////////data for 3D plot/////////////////////////
Plotly.d3.csv('https://raw.githubusercontent.com/plotly/datasets/master/api_docs/mt_bruno_elevation.csv', function(err, rows){
function unpack(rows, key) {
  return rows.map(function(row) { return row[key]; });
}
  
var z_data=[ ]
for(i=0;i<24;i++)
{
  z_data.push(unpack(rows,i));
}

var data = [{
           z: z_data,
           type: 'surface'
        }];
  
var layout = {
  title: '3D Drug Visualization',
  autosize: false,
  width: 500,
  height: 500,
  margin: {
    l: 65,
    r: 50,
    b: 65,
    t: 90,
  }
};

Plotly.newPlot(y, data, layout);
});  



//////////////data for heatmap plot/////////////////////////

var data = [
  {
    z: [[1, 20, 30, 50, 1], [20, 1, 60, 80, 30], [30, 60, 1, -10, 20]],
    x: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
    y: ['Morning', 'Afternoon', 'Evening'],
    type: 'heatmap'
  }
];

Plotly.newPlot(z, data);
 
});
	

	}

*/

	
	


	
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
          </script>
        </dom-module>
      </template>
    </vaadin-demo-snippet>

  </template>
  
  		  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script>
    class GridPaginationDemos extends DemoReadyEventEmitter(GridDemo(Polymer.Element)) {
      static get is() {
        return 'grid-pagination-demos';
      }
	  
	 ready() {
        super.ready();
		/*
		console.log("testtttt");
        var trace1 = {
          x: ['Feature A', 'Feature B', 'Feature C', 'Feature D', 'Feature E'],
          y: [20, 14, 23, 25, 22],
          marker:{
            color: ['rgba(204,204,204,1)', 'rgba(222,45,38,0.8)', 'rgba(204,204,204,1)', 'rgba(204,204,204,1)', 'rgba(204,204,204,1)']
          },
          type: 'bar'
        };
        var data = [trace1];
        var layout = {
          title: 'Least Used Feature'
        };
        Plotly.newPlot(this.$.myDiv, data, layout);
		*/
		
		
	
		
		
		
		
		
		
		
		
      }
    }
    

    
    
    customElements.define(GridPaginationDemos.is, GridPaginationDemos);
  </script>
</dom-module>
